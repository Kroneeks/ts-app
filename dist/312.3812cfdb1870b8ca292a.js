"use strict";(self.webpackChunkfloristby=self.webpackChunkfloristby||[]).push([[312],{3323:(e,t,r)=>{r.r(t),r.d(t,{default:()=>K});var a=r(3007),n=r(1072),i=r(6805),s=r(9250),c=r(1233),o=r(8979),l=r(7779),u=r(4268),d=r(5861),m=r(4687),x=r.n(m),p=(0,u.hg)("articleDetailsPage/fetchArticleRecommendations",function(){var e=(0,d.Z)(x().mark((function e(t,r){var a,n,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.extra,n=r.rejectWithValue,e.prev=1,e.next=4,a.api.get("/articles",{params:{_limit:4}});case 4:if((i=e.sent).data){e.next=7;break}throw new Error;case 7:return e.abrupt("return",i.data);case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",n("error"));case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}()),v=(0,u.HF)({selectId:function(e){return e.id}}),f=(v.getSelectors((function(e){var t,r;return null!==(t=null==e||null===(r=e.articleDetailsPage)||void 0===r?void 0:r.recommendations)&&void 0!==t?t:v.getInitialState()})),(0,u.oM)({name:"articleDetailsPageRecomendation",initialState:v.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:function(e){e.addCase(p.pending,(function(e){e.error=void 0,e.isLoading=!0})),e.addCase(p.fulfilled,(function(e,t){e.isLoading=!1,v.setAll(e,t.payload)})),e.addCase(p.rejected,(function(e,t){e.isLoading=!1,e.error=t.payload}))}}).reducer),g=(0,u.hg)("articleDetailsPage/fetchCommentsByArticleId",function(){var e=(0,d.Z)(x().mark((function e(t,r){var a,n,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.extra,n=r.rejectWithValue,t){e.next=3;break}return e.abrupt("return",n("error"));case 3:return e.prev=3,e.next=6,a.api.get("/comments",{params:{articleId:t,_expand:"user"}});case 6:if((i=e.sent).data){e.next=9;break}throw new Error;case 9:return e.abrupt("return",i.data);case 12:return e.prev=12,e.t0=e.catch(3),e.abrupt("return",n("error"));case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t,r){return e.apply(this,arguments)}}()),h=(0,u.HF)({selectId:function(e){return e.id}}),j=h.getSelectors((function(e){var t,r;return null!==(t=null==e||null===(r=e.articleDetailsPage)||void 0===r?void 0:r.comments)&&void 0!==t?t:h.getInitialState()})),b=(0,u.oM)({name:"articleDetailsCommentsSlice",initialState:h.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:function(e){e.addCase(g.pending,(function(e){e.error=void 0,e.isLoading=!0})),e.addCase(g.fulfilled,(function(e,t){e.isLoading=!1,h.setAll(e,t.payload)})),e.addCase(g.rejected,(function(e,t){e.isLoading=!1,e.error=t.payload}))}}).reducer,L=(0,l.UY)({recommendations:f,comments:b}),N=r(7294),w=r(6478),y=r(5255),k=r(743),A=r(2222),C=r(5140),D=(0,A.P1)(i.wq,C.m5,(function(e,t){return!(!e||!t)&&e.user.id===t.id})),I=r(8519),S=r(5893),P=(0,N.memo)((function(e){var t=e.className,r=void 0===t?"":t,c=(0,n.$G)().t,o=(0,s.s0)(),l=(0,k.v9)(i.wq),u=(0,k.v9)(D),d=(0,N.useCallback)((function(){o(w.h3.articles)}),[o]),m=(0,N.useCallback)((function(){o("".concat(w.h3.articleDetails).concat(null==l?void 0:l.id,"/edit"))}),[o,null==l?void 0:l.id]);return(0,S.jsxs)(I.U,{max:!0,justify:"between",className:(0,a.A)("",{},[r]),children:[(0,S.jsx)(y.zx,{theme:y.bn.OUTLINE,onClick:d,children:c("Назад к списку")}),u&&(0,S.jsx)(y.zx,{theme:y.bn.OUTLINE,onClick:m,children:c("Редактировать")})]})}));P.displayName="ArticleDetailsPageHeader";var q=r(1715),E=r(6628).p.injectEndpoints({endpoints:function(e){return{getArticleRecommendationsList:e.query({query:function(e){return{url:"/articles",params:{_limit:e}}}})}},overrideExisting:!1}).useGetArticleRecommendationsListQuery,O=r(5401),R=r(8834),z=(0,N.memo)((function(e){var t=e.className,r=(0,n.$G)().t,s=E(3),c=s.isLoading,o=s.data,l=s.error,u=(0,O.T)(),d=(0,N.useCallback)((function(){u((0,R.h)())}),[u]);return c||l||!o?null:(0,S.jsxs)(I.g,{gap:"8",className:(0,a.A)("",{},[t]),children:[(0,S.jsx)(q.xv,{size:q.yH.L,title:r("Рекомендуем")}),(0,S.jsx)(i.wD,{onLoadNextPart:d,articles:o,target:"_blank"})]})}));z.displayName="ArticleRecommendationsList";var G=(0,u.hg)("articleDetails/addCommentForArticle",function(){var e=(0,d.Z)(x().mark((function e(t,r){var a,n,s,c,o,l,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.dispatch,n=r.extra,s=r.rejectWithValue,c=r.getState,o=(0,C.m5)(c()),l=(0,i.wq)(c()),o&&t&&l){e.next=5;break}return e.abrupt("return",s("No data"));case 5:return e.prev=5,e.next=8,n.api.post("/comments",{articleId:l.id,userId:o.id,text:t});case 8:if((u=e.sent).data){e.next=11;break}throw new Error;case 11:return a(g(l.id)),e.abrupt("return",u.data);case 15:return e.prev=15,e.t0=e.catch(5),e.abrupt("return",s("error"));case 18:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,r){return e.apply(this,arguments)}}()),H=(0,N.lazy)((0,d.Z)(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(592).then(r.bind(r,7592));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));const U="xIHByGcu",T="dsH_3Oqu",W="zEcWOqpL";var $=r(2949),_=r(3312),F=r(6897),Z=(0,N.memo)((function(e){var t,r=e.className,n=void 0===r?"":r,i=e.comment,s=e.isLoading;return void 0!==s&&s?(0,S.jsxs)(I.g,{gap:"8",max:!0,className:(0,a.A)(U,{},[n]),children:[(0,S.jsxs)("div",{className:T,children:[(0,S.jsx)(_.O,{width:40,height:40,borderR:"50%"}),(0,S.jsx)(_.O,{height:16,width:100})]}),(0,S.jsx)(_.O,{className:W,width:"100%",height:50})]}):i?(0,S.jsxs)(I.g,{gap:"8",max:!0,className:(0,a.A)(U,{},[n]),children:[(0,S.jsxs)(F.F,{to:"".concat(w.h3.profile).concat(i.user.id),className:T,children:[(0,S.jsx)($.q,{size:$.D.SMALL,src:null!==(t=i.user.avatar)&&void 0!==t?t:"https://cdn-icons-png.flaticon.com/512/456/456212.png"}),(0,S.jsx)(q.xv,{title:i.user.username})]}),(0,S.jsx)(q.xv,{className:W,text:i.text})]}):null}));Z.displayName="CommentCard";var M=function(e){var t=e.className,r=void 0===t?"":t,i=e.comments,s=void 0===i?[]:i,c=e.isLoading,o=void 0!==c&&c,l=(0,n.$G)("comments").t;return o?(0,S.jsxs)(I.g,{max:!0,gap:"16",className:(0,a.A)("",{},[r]),children:[(0,S.jsx)(Z,{isLoading:!0}),(0,S.jsx)(Z,{isLoading:!0}),(0,S.jsx)(Z,{isLoading:!0})]}):(0,S.jsx)(I.g,{gap:"16",max:!0,className:(0,a.A)("",{},[r]),children:null!=s&&s.length?s.map((function(e){return(0,S.jsx)(Z,{isLoading:o,comment:e},e.id)})):(0,S.jsx)(q.xv,{title:l("Комментарии отсутствуют")})})},V=function(e){var t;return null===(t=e.articleDetailsPage)||void 0===t||null===(t=t.comments)||void 0===t?void 0:t.isLoading},B=r(9970),Q=r(379),Y=(0,N.memo)((function(e){var t=e.className,r=void 0===t?"":t,i=e.id,s=(0,n.$G)().t,c=(0,O.T)(),o=(0,k.v9)(V),l=(0,k.v9)(j.selectAll);(0,B.Q)((function(){c(g(i))}));var u=(0,N.useCallback)((function(e){c(G(e))}),[c]);return(0,S.jsxs)(I.g,{gap:"16",max:!0,className:(0,a.A)("",{},[r]),children:[(0,S.jsx)(q.xv,{size:q.yH.L,title:s("Комментарии")}),(0,S.jsx)(N.Suspense,{fallback:(0,S.jsx)(Q.a,{}),children:(0,S.jsx)(H,{onSendComment:u})}),(0,S.jsx)(M,{isLoading:o,comments:l})]})}));Y.displayName="ArticleDetailsComments";var J={articleDetailsPage:L};const K=function(e){var t=e.className,r=void 0===t?"":t,l=((0,n.$G)("article-details").t,(0,s.UO)().id);return(0,S.jsx)(c.W,{reducers:J,removeAfterUnmount:!0,children:(0,S.jsx)(o.T,{className:(0,a.A)("",{},[r]),children:(0,S.jsxs)(I.g,{gap:"16",max:!0,children:[(0,S.jsx)(P,{}),(0,S.jsx)(i.D0,{id:l}),(0,S.jsx)(z,{}),(0,S.jsx)(Y,{id:l})]})})})}}}]);
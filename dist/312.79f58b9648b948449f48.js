"use strict";(self.webpackChunkfloristby=self.webpackChunkfloristby||[]).push([[312],{3323:function(e,a,t){t.r(a),t.d(a,{default:function(){return K}});var s=t(3007),i=t(6805),r=t(9250),n=t(1233),c=t(8979),l=t(5857),d=t(4268);const o=(0,d.hg)("articleDetailsPage/fetchArticleRecommendations",(async(e,a)=>{const{extra:t,rejectWithValue:s}=a;try{const e=await t.api.get("/articles",{params:{_limit:4}});if(!e.data)throw new Error;return e.data}catch(e){return s("error")}})),m=(0,d.HF)({selectId:e=>e.id}),g=(m.getSelectors((e=>e?.articleDetailsPage?.recommendations??m.getInitialState())),(0,d.oM)({name:"articleDetailsPageRecomendation",initialState:m.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(o.pending,(e=>{e.error=void 0,e.isLoading=!0})),e.addCase(o.fulfilled,((e,a)=>{e.isLoading=!1,m.setAll(e,a.payload)})),e.addCase(o.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}})),{reducer:x}=g,u=(0,d.hg)("articleDetailsPage/fetchCommentsByArticleId",(async(e,a)=>{const{extra:t,rejectWithValue:s}=a;if(!e)return s("error");try{const a=await t.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!a.data)throw new Error;return a.data}catch(e){return s("error")}})),h=(0,d.HF)({selectId:e=>e.id}),j=h.getSelectors((e=>e?.articleDetailsPage?.comments??h.getInitialState())),p=(0,d.oM)({name:"articleDetailsCommentsSlice",initialState:h.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(u.pending,(e=>{e.error=void 0,e.isLoading=!0})),e.addCase(u.fulfilled,((e,a)=>{e.isLoading=!1,h.setAll(e,a.payload)})),e.addCase(u.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}}),{reducer:L}=p,y=(0,l.UY)({recommendations:x,comments:L});var N=t(1072),v=t(7294),f=t(6478),A=t(5255),C=t(743),w=t(2222),b=t(5140);const D=(0,w.P1)(i.wq,b.m5,((e,a)=>!(!e||!a)&&e.user.id===a.id));var I=t(8519),S=t(5893);const k=(0,v.memo)((e=>{const{className:a=""}=e,{t:t}=(0,N.$G)(),n=(0,r.s0)(),c=(0,C.v9)(i.wq),l=(0,C.v9)(D),d=(0,v.useCallback)((()=>{n(f.h3.articles)}),[n]),o=(0,v.useCallback)((()=>{n(`${f.h3.articleDetails}${c?.id}/edit`)}),[n,c?.id]);return(0,S.jsxs)(I.U,{max:!0,justify:"between",className:(0,s.A)("",{},[a]),children:[(0,S.jsx)(A.zx,{theme:A.bn.OUTLINE,onClick:d,children:t("Назад к списку")}),l&&(0,S.jsx)(A.zx,{theme:A.bn.OUTLINE,onClick:o,children:t("Редактировать")})]})}));k.displayName="ArticleDetailsPageHeader";var P=t(1715);const q=t(6628).p.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e}})})}),overrideExisting:!1}).useGetArticleRecommendationsListQuery;var E=t(5401),O=t(8834);const R=(0,v.memo)((e=>{const{className:a}=e,{t:t}=(0,N.$G)(),{isLoading:r,data:n,error:c}=q(3),l=(0,E.T)(),d=(0,v.useCallback)((()=>{l((0,O.h)())}),[l]);return r??c??!n?null:(0,S.jsxs)(I.g,{gap:"8",className:(0,s.A)("",{},[a]),children:[(0,S.jsx)(P.xv,{size:P.yH.L,title:t("Рекомендуем")}),(0,S.jsx)(i.wD,{onLoadNextPart:d,articles:n,target:"_blank"})]})}));R.displayName="ArticleRecommendationsList";const $=(0,d.hg)("articleDetails/addCommentForArticle",(async(e,a)=>{const{dispatch:t,extra:s,rejectWithValue:r,getState:n}=a,c=(0,b.m5)(n()),l=(0,i.wq)(n());if(!c||!e||!l)return r("No data");try{const a=await s.api.post("/comments",{articleId:l.id,userId:c.id,text:e});if(!a.data)throw new Error;return t(u(l.id)),a.data}catch(e){return r("error")}})),z=(0,v.lazy)((async()=>await t.e(592).then(t.bind(t,7592))));var H="xIHByGcu",G="dsH_3Oqu",U="zEcWOqpL",T=t(2949),W=t(3312),_=t(6897);const F=(0,v.memo)((e=>{const{className:a="",comment:t,isLoading:i=!1}=e;return i?(0,S.jsxs)(I.g,{gap:"8",max:!0,className:(0,s.A)(H,{},[a]),children:[(0,S.jsxs)("div",{className:G,children:[(0,S.jsx)(W.O,{width:40,height:40,borderR:"50%"}),(0,S.jsx)(W.O,{height:16,width:100})]}),(0,S.jsx)(W.O,{className:U,width:"100%",height:50})]}):t?(0,S.jsxs)(I.g,{gap:"8",max:!0,className:(0,s.A)(H,{},[a]),children:[(0,S.jsxs)(_.F,{to:`${f.h3.profile}${t.user.id}`,className:G,children:[(0,S.jsx)(T.q,{size:T.D.SMALL,src:t.user.avatar??"https://cdn-icons-png.flaticon.com/512/456/456212.png"}),(0,S.jsx)(P.xv,{title:t.user.username})]}),(0,S.jsx)(P.xv,{className:U,text:t.text})]}):null}));F.displayName="CommentCard";const M=e=>{const{className:a="",comments:t=[],isLoading:i=!1}=e,{t:r}=(0,N.$G)("comments");return i?(0,S.jsxs)(I.g,{max:!0,gap:"16",className:(0,s.A)("",{},[a]),children:[(0,S.jsx)(F,{isLoading:!0}),(0,S.jsx)(F,{isLoading:!0}),(0,S.jsx)(F,{isLoading:!0})]}):(0,S.jsx)(I.g,{gap:"16",max:!0,className:(0,s.A)("",{},[a]),children:t?.length?t.map((e=>(0,S.jsx)(F,{isLoading:i,comment:e},e.id))):(0,S.jsx)(P.xv,{title:r("Комментарии отсутствуют")})})},V=e=>e.articleDetailsPage?.comments?.isLoading;var B=t(9970),Q=t(379);const Y=(0,v.memo)((e=>{const{className:a="",id:t}=e,{t:i}=(0,N.$G)(),r=(0,E.T)(),n=(0,C.v9)(V),c=(0,C.v9)(j.selectAll);(0,B.Q)((()=>{r(u(t))}));const l=(0,v.useCallback)((e=>{r($(e))}),[r]);return(0,S.jsxs)(I.g,{gap:"16",max:!0,className:(0,s.A)("",{},[a]),children:[(0,S.jsx)(P.xv,{size:P.yH.L,title:i("Комментарии")}),(0,S.jsx)(v.Suspense,{fallback:(0,S.jsx)(Q.a,{}),children:(0,S.jsx)(z,{onSendComment:l})}),(0,S.jsx)(M,{isLoading:n,comments:c})]})}));Y.displayName="ArticleDetailsComments";const J={articleDetailsPage:y};var K=e=>{let{className:a=""}=e;const{id:t}=(0,r.UO)();return(0,S.jsx)(n.W,{reducers:J,removeAfterUnmount:!0,children:(0,S.jsx)(c.T,{className:(0,s.A)("",{},[a]),children:(0,S.jsxs)(I.g,{gap:"16",max:!0,children:[(0,S.jsx)(k,{}),(0,S.jsx)(i.D0,{id:t}),(0,S.jsx)(R,{}),(0,S.jsx)(Y,{id:t})]})})})}}}]);
"use strict";(self.webpackChunkfloristby=self.webpackChunkfloristby||[]).push([[789],{9970:function(e,a,r){r.d(a,{Q:function(){return t}});var n=r(7294);function t(e){(0,n.useEffect)((()=>{e()}),[])}},5789:function(e,a,r){r.r(a),r.d(a,{default:function(){return z}});var n=r(1072),t=r(9250),l=r(8979),o=r(8519),s=r(7294),i=r(5401),c=r(3007),d={ProfileCard:"wW9jgKKD",editing:"DjTe7269",loading:"t07ZxFGs",error:"i5YK3SSb"},u=r(1715),f=r(8312),C=r(379),p=r(2949);let g=function(e){return e.USD="$ USD",e.EUR="€ EUR",e.GBP="£ GBP",e}({});var h=r(4342),m=r(5893);const R=[{value:g.USD,content:g.USD},{value:g.EUR,content:g.EUR},{value:g.GBP,content:g.GBP}],v=(0,s.memo)((e=>{const{t:a}=(0,n.$G)("profilePage"),{className:r="",value:t,readonly:l=!0,onChange:o}=e,i=(0,s.useCallback)((e=>{o?.(e)}),[o]);return(0,m.jsx)(h.w,{className:r,value:t,defaultValue:a("Укажите валюту"),label:a("Укажите валюту"),items:R,onChange:i,readonly:l,direction:"top right"})}));v.displayName="CurrencySelect";let y=function(e){return e.Lithuania="Lithuania",e.Poland="Poland",e.US="United States",e}({});const E=[{value:y.Lithuania,content:y.Lithuania},{value:y.Poland,content:y.Poland},{value:y.US,content:y.US}],x=(0,s.memo)((e=>{const{t:a}=(0,n.$G)("profilePage"),{className:r="",value:t,readonly:l=!0,onChange:o}=e,i=(0,s.useCallback)((e=>{o?.(e)}),[o]);return(0,m.jsx)(h.w,{className:r,value:t,defaultValue:a("Укажите страну"),label:a("Укажите страну"),items:E,onChange:i,readonly:l,direction:"top right"})}));x.displayName="CountrySelect";const N=e=>{const{t:a}=(0,n.$G)("profilePage"),{className:r="",data:t,isLoading:l=!1,error:s="",readonly:i=!0,onChangeFirstname:g,onChangeLastname:h,onChangeAge:R,onChangeCity:y,onChangeUsername:E,onChangeAvatar:N,onChangeCurrency:j,onChangeCountry:T}=e,P={[d.editing]:!i};return l?(0,m.jsx)(o.U,{justify:"center",max:!0,className:(0,c.A)(d.ProfileCard,{[d.loading]:!0},[r]),children:(0,m.jsx)(C.a,{})}):s?(0,m.jsx)(o.U,{justify:"center",max:!0,className:(0,c.A)(d.ProfileCard,{},[r,d.error]),children:(0,m.jsx)(u.xv,{theme:u.lg.ERROR,align:u.PH.CENTER,title:a("Ошибка"),text:a("Непредвиденная ошибка")})}):(0,m.jsxs)(o.g,{max:!0,gap:"16",className:(0,c.A)(d.ProfileCard,P,[r]),children:[t?.avatar&&(0,m.jsx)(o.U,{justify:"center",max:!0,className:d.avatarWrapper,children:(0,m.jsx)(p.q,{src:t?.avatar,alt:a("Аватар"),size:p.D.LARGE})}),(0,m.jsx)(f.I,{value:t?.first,className:d.input,placeholder:a("Ваше имя"),onChange:g,readonly:i}),(0,m.jsx)(f.I,{value:t?.lastname,className:d.input,placeholder:a("Ваша фамилия"),onChange:h,readonly:i}),(0,m.jsx)(f.I,{value:t?.age,className:d.input,placeholder:a("Ваш возраст"),onChange:R,readonly:i}),(0,m.jsx)(f.I,{value:t?.city,className:d.input,placeholder:a("Город"),onChange:y,readonly:i}),(0,m.jsx)(f.I,{value:t?.username,className:d.input,placeholder:a("Имя пользователя"),onChange:E,readonly:i}),(0,m.jsx)(f.I,{value:t?.avatar,className:d.input,placeholder:a("Введите ссылку на аватар"),onChange:N,readonly:i}),(0,m.jsx)(v,{className:d.input,onChange:j,readonly:i,value:t?.currency}),(0,m.jsx)(x,{className:d.input,onChange:T,readonly:i,value:t?.country})]})};var j=r(743);const T=e=>e.profile?.error,P=e=>e.profile?.form,b=e=>e.profile?.isLoading,O=e=>e.profile?.readonly,A=e=>e.profile?.validateError;var U=r(4268);const I=(0,U.hg)("profile/fetchProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n}=a;try{const a=await r.api.get(`/profile/${e}`);if(!a.data)throw new Error;return a.data}catch(e){return n("error")}}));let _=function(e){return e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR",e}({});const S=(0,U.hg)("profile/updateProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n,getState:t}=a,l=P(t()),o=(e=>{if(!e)return[_.NO_DATA];const{first:a,lastname:r,age:n,country:t}=e,l=[];return a&&r||l.push(_.INCORRECT_USER_DATA),(!n||!Number.isInteger(n)||n>200||n<0)&&l.push(_.INCORRECT_AGE),t||l.push(_.INCORRECT_COUNTRY),l})(l);if(o.length)return n(o);try{const e=await r.api.put(`/profile/${l?.id}`,l);if(!e.data)throw new Error;return e.data}catch(e){return n([_.SERVER_ERROR])}})),k=(0,U.oM)({name:"profile",initialState:{readonly:!0,isLoading:!1,error:void 0,data:void 0},reducers:{setReadonly:(e,a)=>{e.readonly=a.payload},cancelEdit:e=>{e.readonly=!0,e.validateError=void 0,e.form=e.data},updateProfile:(e,a)=>{e.form={...e.form,...a.payload}},saveProfile:e=>{e.readonly=!0}},extraReducers:e=>{e.addCase(I.pending,(e=>{e.error=void 0,e.isLoading=!0})),e.addCase(I.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload})),e.addCase(I.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload})),e.addCase(S.pending,(e=>{e.validateError=void 0,e.isLoading=!0})),e.addCase(S.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload,e.readonly=!0,e.validateError=void 0})),e.addCase(S.rejected,((e,a)=>{e.isLoading=!1,e.validateError=a.payload}))}}),{actions:D}=k,{reducer:L}=k;var w=r(1233),G=r(9970),$=r(5140);const V=e=>e.profile?.data;var M=r(5255);const W=(0,s.memo)((e=>{const{className:a}=e,{t:r}=(0,n.$G)("profilePage"),t=(0,j.v9)($.m5),l=(0,j.v9)(V),d=t?.id===l?.id,f=(0,j.v9)(O),C=(0,i.T)(),p=(0,s.useCallback)((()=>{C(D.setReadonly(!1))}),[C]),g=(0,s.useCallback)((()=>{C(D.cancelEdit())}),[C]),h=(0,s.useCallback)((()=>{C(S())}),[C]);return(0,m.jsxs)(o.U,{max:!0,justify:"between",className:(0,c.A)("",{},[a]),children:[(0,m.jsx)(u.xv,{title:r("Профиль")}),d&&(0,m.jsx)(m.Fragment,{children:f?(0,m.jsx)(M.zx,{theme:M.bn.OUTLINE,onClick:p,children:r("Редактировать")}):(0,m.jsxs)(o.U,{gap:"8",children:[(0,m.jsx)(M.zx,{theme:M.bn.OUTLINE_RED,onClick:g,children:r("Отменить")}),(0,m.jsx)(M.zx,{theme:M.bn.OUTLINE,onClick:h,children:r("Сохранить")})]})})]})}));W.displayName="EditableProfileCardHeader";const Q={profile:L},Y=(0,s.memo)((e=>{const{id:a}=e,{t:r}=(0,n.$G)("profilePage"),t=(0,i.T)(),l=(0,j.v9)(P),o=(0,j.v9)(b),c=(0,j.v9)(T),d=(0,j.v9)(O),f=(0,j.v9)(A);(0,G.Q)((()=>{a&&t(I(a))}));const C={[_.SERVER_ERROR]:r("Серверная ошибка"),[_.INCORRECT_AGE]:r("Некорректный возраст"),[_.INCORRECT_COUNTRY]:r("Некорректный регион"),[_.INCORRECT_USER_DATA]:r("Имя и фамилия обязательны"),[_.NO_DATA]:r("Данные не указаны")},p=(0,s.useCallback)((e=>{t(D.updateProfile({first:e??""}))}),[t]),g=(0,s.useCallback)((e=>{t(D.updateProfile({lastname:e??""}))}),[t]),h=(0,s.useCallback)((e=>{/^\d+$/.test(e??"")&&t(D.updateProfile({age:Number(e)??0}))}),[t]),R=(0,s.useCallback)((e=>{t(D.updateProfile({city:e??""}))}),[t]),v=(0,s.useCallback)((e=>{t(D.updateProfile({username:e??""}))}),[t]),y=(0,s.useCallback)((e=>{t(D.updateProfile({avatar:e??""}))}),[t]),E=(0,s.useCallback)((e=>{t(D.updateProfile({currency:e}))}),[t]),x=(0,s.useCallback)((e=>{t(D.updateProfile({country:e}))}),[t]);return(0,m.jsxs)(w.W,{reducers:Q,children:[(0,m.jsx)(W,{}),f?.length&&f?.map((e=>(0,m.jsx)(u.xv,{theme:u.lg.ERROR,text:C[e]},e))),(0,m.jsx)(N,{data:l,isLoading:o,error:c,readonly:d,onChangeFirstname:p,onChangeLastname:g,onChangeAge:h,onChangeCity:R,onChangeUsername:v,onChangeAvatar:y,onChangeCurrency:E,onChangeCountry:x})]})}));Y.displayName="EditableProfileCard";var z=e=>{const{className:a=""}=e,{t:r}=(0,n.$G)("profilePage"),{id:s}=(0,t.UO)();return s?(0,m.jsx)(l.T,{className:(0,c.A)("",{},[a]),children:(0,m.jsx)(o.g,{max:!0,gap:"16",children:(0,m.jsx)(Y,{id:s})})}):(0,m.jsx)(u.xv,{theme:u.lg.ERROR,text:r("Не удалось загрузить профиль")})}},1233:function(e,a,r){r.d(a,{W:function(){return s}});var n=r(7294),t=r(743),l=r(5401),o=r(5893);const s=e=>{const{children:a,reducers:r,removeAfterUnmount:s=!0}=e,i=(0,t.oR)(),c=(0,l.T)();return(0,n.useEffect)((()=>{const e=i.reducerManager.getMountedReducers();return Object.entries(r).forEach((a=>{let[r,n]=a;e[r]||(i.reducerManager.add(r,n),c({type:`@INIT ${r} reducer`}))})),()=>{s&&Object.entries(r).forEach((e=>{let[a,r]=e;i.reducerManager.remove(a),c({type:`@DESTROY ${a} reducer`})}))}}),[c,r,s,i.reducerManager]),(0,o.jsx)(o.Fragment,{children:a})}},8312:function(e,a,r){r.d(a,{I:function(){return o}});var n=r(3007),t=r(7294),l=r(5893);const o=(0,t.memo)((e=>{const{className:a="",value:r="",type:t="text",placeholder:o="",onChange:s,readonly:i=!1,"data-testid":c="",...d}=e,u={fTN1PnWu:i};return(0,l.jsx)("div",{className:(0,n.A)("X8EVbQ1x",u,[a]),children:(0,l.jsx)("input",{type:t,value:r,readOnly:i,onChange:e=>{s?.(e.target.value)},placeholder:o,...d})})}));o.displayName="Input"},8979:function(e,a,r){r.d(a,{T:function(){return u}});var n=r(3007),t=r(7294),l=r(5401),o=r(8183),s=r(9250),i=r(9970),c=r(743),d=r(5893);const u=(0,t.memo)((e=>{const{className:a="",children:r,onScrollEnd:u}=e,f=(0,t.useRef)(),C=(0,t.useRef)(),p=(0,l.T)(),{pathname:g}=(0,s.TH)(),h=(0,c.v9)((e=>(0,o.Qi)(e,g)));!function(e){let{callback:a,wrapperRef:r,triggerRef:n}=e;(0,t.useEffect)((()=>{let e=null;if(a){const t={root:r.current,rootMargin:"0px",threshold:1};return e=new IntersectionObserver((e=>{let[r]=e;r.isIntersecting&&a()}),t),e.observe(n.current),()=>{e&&n.current&&e.unobserve(n.current)}}}),[r,n,a])}({triggerRef:C,wrapperRef:f,callback:u}),(0,i.Q)((()=>{f.current.scrollTop=h}));const m=function(e,a){const r=(0,t.useRef)(!1);return(0,t.useCallback)((function(){r.current||(e(...arguments),r.current=!0,setTimeout((()=>{r.current=!1}),500))}),[e,500])}((e=>{p(o.Aw.setScrollPosition({position:e.currentTarget.scrollTop,path:g}))}));return(0,d.jsxs)("main",{ref:f,className:(0,n.A)("a83jDcrK",{},[a]),onScroll:m,children:[r,u?(0,d.jsx)("div",{className:"VaPQ__zP",ref:C}):null]})}));u.displayName="Page"}}]);